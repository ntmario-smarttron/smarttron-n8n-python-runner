services:
  n8n-runner:
    image: node:20-bookworm
    restart: unless-stopped
    command: >
      bash -c "
      apt-get update &&
      apt-get install -y python3 python3-pip libjpeg-dev zlib1g-dev libpng-dev &&
      pip3 install pillow piexif exifread &&
      npm install -g @n8n/task-runner &&
      n8n-task-runner"
    environment:
      - N8N_RUNNERS_AUTH_TOKEN=runner-secret
      - N8N_RUNNERS_TASK_BROKER_URI=http://n8n:5679
