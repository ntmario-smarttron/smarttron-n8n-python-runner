services:
  n8n-runner:
    image: node:20-bookworm
    restart: unless-stopped
    command: >
      bash -c "
      apt-get update &&
      apt-get install -y python3 python3-venv python3-pip libjpeg-dev zlib1g-dev libpng-dev &&
      python3 -m venv /opt/venv &&
      /opt/venv/bin/pip install pillow piexif exifread &&
      npm install -g @n8n/task-runner &&
      export PATH='/opt/venv/bin:$PATH' &&
      n8n-task-runner"
    environment:
      - N8N_RUNNERS_AUTH_TOKEN=runner-secret
      - N8N_RUNNERS_TASK_BROKER_URI=http://n8n:5679
